# Day5：タイトル画面とカウントダウンの日（7人×3時間用シナリオ／講師用）

## 0. 今日のゴール（先生が最初に読む用）

3時間で、次を「クラス全体」として完成させます。

1. ゲーム起動時に **タイトル画面** が表示される  
2. Enter キーでタイトルを閉じると、画面中央に **3 → 2 → 1 → Go! のカウントダウン** が流れる  
3. カウントダウンが終わると自動でランゲーム本編が始まり、Day4 同様にジャンプ・障害物・GameOver が動く  
4. GameOver 画面から **R キーで即再スタート**、Enter キーで **タイトルに戻る** ことができる  
5. （発展）BGM や効果音のフック位置がコメントで示されている  

ここまでできれば、  
「**ゲームの状態（モード）を変えながら、1本の main_day5 で流れを制御する**」  
という Day5 の学習目標は達成です。

### この日のねらい（学習指導案レベル）

- **情報：プログラムの状態（state）の概念**  
  - 変数 `mode` に `"title" / "countdown" / "playing" / "gameover"` を入れ替えながら、
    `update()` の中で分岐させることで「ゲームの場面」を切り替える。
- **数学・物理：Day1〜4 の復習**  
  - 重力・速度・矩形当たり判定（AABB）を「状態遷移の一場面」として整理し直す。
- **協働学習：7人×3時間の役割分担**  
  - 「タイトル」「カウントダウン」「ゲーム本編」「GameOver演出」「テスト」など、
    役割ごとに担当範囲と合流ポイントを明確にする。

Day1〜4 と同様に、「誰がどのファイルのどこをいじるのか」を最初に固定してから作業に入るのがおすすめです。fileciteturn4file0L1-L40

---

## 1. 今日の7人の役割（先に割り当てる）

| No | 役割名                         | 触るファイル                        | ざっくりやること                                              |
|----|--------------------------------|-------------------------------------|----------------------------------------------------------------|
| A  | タイトル画面担当               | `main_day5_student.py`             | `enter_title()` の文言・HUD 表示・タイトルデザインを整える   |
| B  | カウントダウン担当             | `main_day5_student.py`             | `start_countdown()` と `update()` のカウント処理を書く        |
| C  | ゲーム本編（ランナー）担当     | `main_day5_student.py`             | Day4 相当のジャンプ・障害物・スコアのロジックを読む／整理    |
| D  | GameOver ＋ リスタート担当     | `main_day5_student.py`             | `game_over()` と R/Enter キーでの遷移を完成させる            |
| E  | BGM/SE フック担当（発展）      | `main_day5_student.py`, `assets/`  | カウントダウン・GameOver などに `SoundLoader` を差し込む      |
| F  | つなぎ込み担当（モード管理）   | `main_day5_student.py`             | `mode` 変数と `update()` の分岐を整理し、全体の動作を確認    |
| G  | テスト＆バグログ担当           | `docs/Day5/Day5_buglog.md`         | 動作確認と、気づいたことをバグログに残す                      |

> 先生メモ：  
> - A〜F は全員 `main_day5_student.py` を開きますが、「自分のセクション」を中心に触るように伝えると衝突が減ります。  
> - G は早い段階から `python main_day5_teacher.py`（講師用サンプル）で挙動を確認しておき、  
>   「本来どう動くか」を知った上で Day5 生徒版のテストをするとよいです。

---

## 2. 今日の時間割（板書用）

- 0:00〜0:10　Day4 の振り返り（ジャンプ／GameOver／Rリスタート）  
- 0:10〜0:25　Day5 のゴール説明＆7人の役割分担  
- 0:25〜1:10　**個人作業1**：A〜F がそれぞれの担当セクションを読む＆手を動かす  
- 1:10〜1:40　**結合フェーズ**：F が中心となって `mode` と `update()` を一度通して確認  
- 1:40〜2:20　**個人作業2**：演出の調整／文言の推敲／（余裕があれば）サウンド追加  
- 2:20〜2:45　**テスト＆バグログ記入**：G 主導で `Day5_buglog.md` を埋めていく  
- 2:45〜3:00　全員で画面お披露目＆振り返り

---

## 3. 各役割の「やることチェックリスト」

### 3-1. A：タイトル画面担当

**目的**：  
ゲーム起動直後の画面を「ただの真っ暗な状態」ではなく、  
「ゲームタイトル＋操作説明」がきちんと出る状態にする。

- [ ] `main_day5_student.py` の `enter_title()` 関数を見つけた  
- [ ] `self.mode = "title"` をセットするコードを書いた  
- [ ] `self.center_message.text` にタイトルと「[Enter]でスタート」の案内を入れた  
- [ ] タイトル中はスコアではなく、「今日は Day5 で何をするか」を HUD に表示した  

サンプルイメージ：

```python
def enter_title(self):
    """タイトル画面に入るときに呼ぶ。"""
    self.mode = "title"
    self.gameover = False
    self.countdown = 3.0
    self.center_message.text = "Neon Runner C\n[Enter] でスタート"
```

説明のポイント：

- 「ゲームの最初の1フレームで何が起きるか」をクラス全体で言語化する  
  → `__init__()` の最後で `enter_title()` が呼ばれていることを確認させる。  
- `center_message` と `hud` の **役割の違い** を整理する  
  → 中央は「場面のメッセージ」、左上は「状態の表示」。

---

### 3-2. B：カウントダウン担当

**目的**：  
タイトルからゲーム本編までの「3,2,1,Go!」を `mode` と `countdown` で制御する。

- [ ] `start_countdown()` に `self.mode = "countdown"` を書いた  
- [ ] `self.countdown = 3.0` をセットして、毎フレーム `dt` だけ減らすコードを書いた  
- [ ] `update()` の先頭で `mode == "countdown"` のときの処理を追加した  
- [ ] `countdown` が 0 未満になったら `start_gameplay()` を呼ぶようにした  

画面に出したいイメージ（例）：

```text
3（1秒） → 2（1秒） → 1（1秒） → Go!（短く） → プレイ開始
```

余裕があれば、  
- 数字の色を変える  
- Go! のときだけランナーを少し光らせる  
といった演出を相談してもよいです。

---

### 3-3. C：ゲーム本編（ランナー）担当

**目的**：  
Day4 までの「ジャンプ／着地／障害物／スコア」を Day5 コードの中で理解し直す。

具体的には、次のような箇所を読み、コメントを書き足してもらいます。

- `reset_core_state()` の中で、どの変数が「物理の状態」を表しているか  
  - 例：`self.y`, `self.vy`, `self.on_ground` など  
- `spawn_obstacle()` の中で、障害物の位置と大きさがどのように決まっているか  
- `update()` の「重力」「スクロール」「当たり判定」「スコア加算」の順番  

先生向け目安：

- 生徒には「Day4 でやったはずのことを、自分の言葉で説明してみよう」と問いかける。  
- Day5 では **新しいアルゴリズムはほとんど増やさず**、「状態遷移」に集中させる。

---

### 3-4. D：GameOver ＋ リスタート担当

**目的**：  
GameOver になったときに `mode` を切り替え、R キー／Enter キーで  
「もう一度」か「タイトルに戻るか」を選べるようにする。

チェックリスト：

- [ ] `game_over()` 内で `self.mode = "gameover"` をセットした  
- [ ] `center_message.text` に GameOver の案内メッセージを書いた  
- [ ] `_on_key_down()` で `mode == "gameover"` のときのキー処理を追加した  
  - R キー（`ord("r")`）→ `start_countdown()`  
  - Enter キー（`13`） → `enter_title()`  

---

### 3-5. E：BGM/SE フック担当（発展）

**目的**：  
サウンドの読み込みと再生位置を「コメントレベル」で示すか、時間があれば実装まで行う。

- [ ] `from kivy.core.audio import SoundLoader` の import を確認した  
- [ ] `__init__()` か専用メソッドで BGM/SE をロードする場所にコメントを入れた  
- [ ] `start_countdown()` / `start_gameplay()` / `game_over()` の中に  
      「ここで効果音を鳴らす」といったコメントを追加した  

実装例は講師用サンプル `main_day5_teacher.py` にコメント付きで用意しておき、  
クラスに見せながら「音を足したい人はここを真似してみよう」と案内すると安全です。

---

### 3-6. F：つなぎ込み担当（モード管理）

**目的**：  
`mode` と `update()` の分岐を整理し、「どの状態でどの処理が走るか」を図にできるようにする。

- [ ] ホワイトボードなどに「状態遷移図」を描いた  
  - `title → countdown → playing → gameover → (title or countdown)`  
- [ ] `update()` の最初に `mode == "title"` / `"countdown"` の早期 return を入れた  
- [ ] GameOver 時に物理シミュレーションが止まることを確認した  

---

### 3-7. G：テスト＆バグログ担当

**目的**：  
Day5 全体の挙動を確認し、「気づき」を文章として残す。

- [ ] `python main_day5_teacher.py` で理想的な動作を確認した  
- [ ] `python main_day5_student.py` でクラスの進捗版を確認した  
- [ ] 気づいた違い／バグを `docs/Day5/Day5_buglog.md` に書いた  
- [ ] Day6 以降に回したい「改善案」もメモしておいた  

例：

```text
■気づき1：カウントダウンの数字が一瞬しか見えない
    → update() で countdown の扱いを確認。もう少しゆっくり減らす案を検討。
```

---

## 4. 全員共通のNGリスト

- Day4 までの `main_day1.py`〜`main_day4.py` は **参照のみ**（編集・保存しない）  
- 他の人の担当セクションを勝手に削除しない  
- 分からないエラーを黙って直さない  
  - → 一度 `Day5_buglog.md` に書いてから先生と相談する  

---

## 5. 今日のまとめメモ欄（クラス用）

- 今日できたこと：

- 次にやりたいこと（Day6 以降の宿題案など）：
